<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8"> 
		<link rel="stylesheet" type="text/css" href="/assets/styles/styles.css">
		
		<link rel="stylesheet" type="text/css" href="/assets/styles/highlight.css">
		
		<title>The music I listen to - foobuzz</title>
	</head>
	
	<body>
	<div id="main_wrapper">
	
		<header>
			<h1><a href="/">foobuzz</a></h1>
		</header>
		
		<nav>
			<ul id="navigation">
				<li><a href="/">Front</a></li>
			    <li><a href="/archives">Archives</a></li>
			    <li><a href="/about">About</a></li>
			</ul>

			
		 	<ul id="networking">
				
					<li><a href="https://twitter.com/_foobuzz"><img src="/assets/icons/twitbird.png" alt="The Twitter icon"></a></li>
				
				
					<li><a href="https://github.com/foobuzz"><img src="/assets/icons/github.png" alt="The GitHub icon"></a></li>
				
					<li><a href="/feed.xml"><img src="/assets/icons/atom.png" alt="The RSS/Atom icon"></a></li>
			</ul>
			
		</nav>
		
		<div id="main">
		
			<div id="content">

				

<article>

	<div class="entete">by Valentin, January 18 2016, in
		
		<a href="/tag/software">software</a>, 
		
		<a href="/tag/python">python</a>, 
		
		<a href="/tag/data">data</a>
		
	</div>

	<h1><a href="/foobar2000">The music I listen to</a></h1>

	

<p>When I switched to Linux last summer, the only software non compatible with Linux that I couldn't do without was <a href="https://www.foobar2000.org/">foobar2000</a>. I make it work using Wine. There are several reasons I consider this audio player and library manager to be superior to many others. To begin, its GUI is highly customizable via the so-called "Layout Editing Mode". There are a fair number of useful widgets that you can choose from and place on the screen, using a system of vertical and horizontal splits that you can add recursively. </p>
<p>Another good feature are the "Global Hotkeys", which make it possible to map keyboard shortcuts to various commands (pause, next song, change volume, switch the playlist order from random to default, etc), and these shortcuts work even if the player hasn't the focus. It's particularly useful when playing video games while listening to music.</p>
<p>Finally, plugins can be installed, some of which are powerful. My favorite is "Playback Statistics" which keeps track of the time a song has been added to the library, the first time and last time it has been played, and its play count.</p>
<p>Using this plugin, I like to compute my own little charts and see statistics about the music I listen to. However, exporting the data to a programmatically exploitable format wasn't as easy as I thought.</p>
<h2>The ID mystery</h2>
<p>Playback Statistics (PS) has a feature that allow one to "export data" (resp. "import data"). The intent of this feature is to make it possible to share statistics across different foobar2000 installations. The exported file is an XML file containing one node per song in the library with an attribute for each piece of data. Here's an example of a node corresponding to one song:</p>
<div class="codehilite"><pre class="source"><code><span class="nt">&lt;Entry</span> <span class="na">ID=</span><span class="s">"eef3112353c1512d"</span> <span class="na">Count=</span><span class="s">"5"</span> <span class="na">FirstPlayed=</span><span class="s">"130818970132330604"</span> <span class="na">LastPlayed=</span><span class="s">"130913311506349590"</span> <span class="na">Added=</span><span class="s">"130739450382613924"</span> <span class="nt">/&gt;</span>
</code></pre></div>
<p>The timestamps for the last three attributes are in the Microsoft <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms724284%28v=vs.85%29.aspx">FILETIME format</a>. It's the number of 100-nanoseconds since January 1 1601. <a href="https://blogs.msdn.microsoft.com/oldnewthing/20090306-00/?p=18913/">Don't ask me</a>.</p>
<p>The problem is that the song is identified by an ID and nobody knows how it's computed from the song. The <a href="http://wiki.hydrogenaud.io/index.php?title=Foobar2000:Components/Playback_Statistics_v3.x_%28foo_playcount%29">PS documentation</a> implies that the ID is computed from the following song's metadata: artist, title, album, disc number, track number. However, from <a href="https://github.com/tfriedel/foobar2000-export/issues/1">GitHub</a> to <a href="https://hydrogenaud.io/index.php/topic,103977.msg853596.html#msg853596">Hydrogen Audio</a>, nobody succeeded in guessing how the ID is computed from a song.</p>
<p>I tried to break the mysterious hash myself without success. I did two successive exports separated by a specific song's listening session. In the two XML files, I spotted the only element that had a PlayCount increment and deduced that it was the song I'd listened to. Note that the order of the songs aren't always the same, so I couldn't perform a simple diff and had to actually parse the XML to spot the difference. Having linked one song to its ID, I then tried to brute-force the ID. I tried all the combinations of the metadata said to be used in the documentation, with various separators between the fields, then encoded with various character encodings, then hashed with the most famous hash functions. At the heart of this 4 for-loops imbrication, I finally tested if the mysterious ID was a substring of the obtained hash. This resulted in zero match. I figured that the author could have used a more complicated hashing process. He could even have used a custom salt somewhere in the process. This was hopeless.</p>
<p>The next logical step was probably either to contact the plugin's author or to try to decompile the plugin's dll. But this is when I stumbled upon this <a href="https://www.hydrogenaud.io/forums/index.php?showtopic=97456">Hydrogen Audio thread</a> where a method to link each song of the library to its ID was exposed. This method relies on another plugin, "Text Tools". This plugin enables the user to export text information about the songs in the library, accessing the songs' metadata. Foobar2000 exposes metadata in the form of variables surrounded by the <code>%</code> symbol. For example, <code>%title%</code> gives the song's title. Fair enough, the PS plugin exposes its own variables (play count, first played, etc) using this format. For example, <code>%play_count%</code> gives the song's play count. Wonderful! Using only Text Tools I was then able to export all relevant information about the library!</p>
<h2>The Music Diary</h2>
<p>On the Figure 1 (you can right-click on it and click to "Show Image" to see the full-size version), each point represents a tracked song from my library. A tracked song is a song that I listened to at least one time since I've installed the Playback Statistics plugin. The plugin increments the play count of a song when the player plays at least one straight minute of it. This leads to misleadings numbers. For example, one of the track I've listened the most to is The Fourth Movement of Beethoven's Fifth Symphony, with a Play Count (PC) of 102. However, this track is about 10 minutes long and I know that I've mostly listened only to the last 3 minutes of it. (What an epic finale!)</p>
<figure>
<img alt="Graph representing the Play Count on the Y-axis and the first time played in the X-axis" src="assets/articles/music-diary.png">
<figcaption><strong>Figure 1</strong><strong></strong></figcaption>
</img></figure>
<p>The X-axis represents the first time I've listened to a song. The Y-axis represents the Play Count of the song as of the writing of this article. It's not a surprise that the left of the graph, starting a little before June 2013, is flooded with many songs. That's all the songs I was casually listening to suddenly starting being tracked by the plugin. However, you can obverse the same phenomenon one year later in June 2014, which contains a high concentration of new songs too. That's because I like to explore new music during the summer holidays. The effect lose strength in the summer of 2015, which I assume is because I was doing an internship and didn't have as much time as I had during previous summers.</p>
<p>An interesting phenomenon takes place between September 2013 and February 2014. As you can see, I haven't discovered many songs in this period. However, the few I did I listened to them a lot of times! Well, this period was when I moved outside my parents' to study in a new city and I didn't have an Internet connexion in my new apartment. I remember exploring a bit of music at my school's computers and listening to them a lot in my apartment as I didn't have much to do.</p>
<p>I have a few ultra popular songs that I listen to massively. <a href="https://www.youtube.com/watch?v=zgsDf73rm_0">Breaking Through by Audiomachine</a> holds the record with a stratospheric 153 PC. Songs with the highest PC tends to be older, having been listened for the first time around 2013. This makes sense, since the older a song is, the more time I have to listen to it repetitively and increment its PC. My favorite songs that I discovered recently are <a href="https://www.youtube.com/watch?v=MYSVMgRr6pw">Take me To Church by Hozier</a> and <a href="https://www.youtube.com/watch?v=HtPL2YhK6h0">Take a Look Around by Limp Bizkit</a>. The former is recent and I discovered it when it became popular worldwide. The latter dates back from 2000 and I just became fond of it when I discovered it last summer. I played it in loop while playing <a href="http://www.urbanterror.info/home/"><em>Urban Terror</em></a>, which certainly contributed to its high PC.</p>
<p>You can see vertical ribs, for example at the beginning of last December or at the beginning of March 2015. That's when I discover an album. I listen to the whole album in one go. Then I listen to each track individually according to my preferences. Each track then evolves on the album's vertical line.</p>
<p>Finally, you can see how serious I am each year before my finals, during a little period around the end of April and the beginning of May, where I don't listen to any new song, except for <a href="https://www.youtube.com/watch?v=BPbSCENrY4g">Audiomachine's Millennium</a> in May 2015. Indeed, I remember discovering it at the end of <a href="https://www.youtube.com/watch?v=1DiMjOWlbmM">this movies montage</a> during a procrastinating session.</p>
<h2>The Fluff Principle</h2>
<p>The Fluff Principle is a term invented by <a href="https://en.wikipedia.org/wiki/Paul_Graham_%28computer_programmer%29">Paul Graham</a> in a <a href="http://www.paulgraham.com/hackernews.html">February 2009 article</a>. The Hacker News creator gives the following definition:</p>
<blockquote>
<p>on a user-voted news site, the links that are easiest to judge will take over unless you take specific measures to prevent it.</p>
</blockquote>
<p>He explains that one type of fluff is short content. It's faster to consume a joke or a picture than an in-depth article. Therefore, at equal quality, the former will gain more upvotes per unit of time than the latter.</p>
<p>Well, the Fluff Principle also holds for my music statistics. It's faster to listen to a short song than to a long one. Therefore, at equal quality, short songs will gain more PC by unit of time than long ones. For example, my top one song, Audiomachine's Breaking Through (153 PC), is only 1:18 long. I know that I've listened to another song, <a href="https://www.youtube.com/watch?v=SNuwOYQPr-s">Seven Angels by Avantasia</a> a crazy amount of time, each time the whole thing. However, this song is 14:17, so it's not quite a surprise that its PC is only 31. Now if I want to know how much time I've been listening to each song, that is, the total amount of time I was listening while the song was playing, I have to multiple the PC by the song's duration. <em>Breaking Through</em> hits 153×(1×60+18) = 11,934 seconds. <em>Seven Angels</em> hits 37×(14×60+17) = 31,709 seconds. Wow! I've listened to <em>Seven Angels</em> way more than to <em>Breaking Through</em>!</p>
<p>Following this observation, we can define the Normalized Play Count (NPC) as the following: NPC(song) = PC(song)×Duration(song)/AD where AD is the Average Duration of a tracked song. This way, for songs which have a duration close to the average duration, their NPC will be approximately equal to their PC. The NPC plays an important role for particularly short songs, for which it diminishes their importance, and for long songs, for which it increases the importance.</p>
<p>The table on Figure 2 shows the top 20 songs in my library sorted by their NPC, in the reverse order. This table contains several anomalies that are due to the fact that the PS plugin increments the PC of a song only when 1 minute of it is played. Anomalies are very long tracks whose duration tends to give them a high NPC when in reality I listened only to a part of them. The anomalies are:</p>
<ul>
<li>
<p><strong>Ranked 1:</strong> It's 20 minutes long, but I know I almost never listen beyond the 10 minutes mark.</p>
</li>
<li>
<p><strong>Ranked 2:</strong> It's 10 minutes long, but I almost always listen to its finale, that is the last 3-4 minutes.</p>
</li>
<li>
<p><strong>Ranked 6:</strong> Final song of the album. I usually only listen to the first 3-4 minutes.</p>
</li>
<li>
<p><strong>Ranked 9:</strong> I never listen to the Quasimodo Suite, which is quite lengthy.</p>
</li>
</ul>
<figure>
<table>
<thead>
<tr>
<th>Rank</th><th>Artist</th><th>Title</th><th>NPC</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>Beethoven</td><td>Piano Concerto No.5: Mvt. I</td><td>384.107</td>
</tr>
<tr>
<td>2</td><td>Beethoven</td><td>Symphony No.5 - IV Allegro</td><td>320.7867</td>
</tr>
<tr>
<td>3</td><td>Dvorak</td><td>Symphony No. 9: II. Largo</td><td>143.867</td>
</tr>
<tr>
<td>4</td><td>Avantasia</td><td>The Seven Angels</td><td>109.836</td>
</tr>
<tr>
<td>5</td><td>M83</td><td>Raconte-Moi Une Histoire</td><td>97.736</td>
</tr>
<tr>
<td>6</td><td>Awolnation</td><td>Knights of Shame</td><td>96.200</td>
</tr>
<tr>
<td>7</td><td>Audiomachine</td><td>Rising Dawn</td><td>95.217</td>
</tr>
<tr>
<td>8</td><td>Zack Hemsey</td><td>Vengeance</td><td>90.881</td>
</tr>
<tr>
<td>9</td><td>Santa Esmeralda</td><td>The House of the Rising Sun + Quasimodo Suite</td><td>85.195</td>
</tr>
<tr>
<td>10</td><td>Limp Bizkit</td><td>Take a Look Around</td><td>83.250</td>
</tr>
<tr>
<td>11</td><td>Mahler</td><td>Symphony No. 1 - Mvt. IV</td><td>81.503</td>
</tr>
<tr>
<td>12</td><td>Beethoven</td><td>Symphony No.5 - II Adante con moto</td><td>80.673</td>
</tr>
<tr>
<td>13</td><td>Macklemore &amp; Ryan Lewis</td><td>Wing$</td><td>80.525</td>
</tr>
<tr>
<td>14</td><td>Hozier</td><td>Take Me to Church</td><td>79.947</td>
</tr>
<tr>
<td>15</td><td>Hans Zimmer</td><td>Mombasa</td><td>78.914</td>
</tr>
<tr>
<td>16</td><td>Edwyn Collins</td><td>A Girl Like You</td><td>78.295</td>
</tr>
<tr>
<td>17</td><td>Beethoven</td><td>Moonlight Sonata - Third Movement</td><td>78.282</td>
</tr>
<tr>
<td>18</td><td>Beethoven</td><td>Piano Concerto No.5: Mvt. II</td><td>75.685</td>
</tr>
<tr>
<td>19</td><td>M83</td><td>Wait</td><td>73.653</td>
</tr>
<tr>
<td>20</td><td>Beethoven</td><td>Piano Concerto No.5: Mvt. III</td><td>72.167</td>
</tr>
</tbody>
</table>
<figcaption><strong>Figure 2</strong></figcaption>
</figure>
<p>Well, I sure like Beethoven.</p>
	
</article>

<div id="front_nav">
	
	
	<a href="/reddit-np">Previous</a>
</div>



			</div>
			
			<aside>
				<section>
					<h2>Last articles</h2>

					<ul>
						
							<li><a href="/foobar2000">The music I listen to</a></li>
						
							<li><a href="/reddit-np">The np problem, Reddit edition</a></li>
						
							<li><a href="/datetime-python">Datetime in Python</a></li>
						
							<li><a href="/firestory">Why Firefox was losing track of my history</a></li>
						
					</ul>
				</section>
				
				<section>
					<h2>Tags</h2>
					
					<ul>
						
							<li><a href="/tag/data">data</a> (2)</li>
						
							<li><a href="/tag/programming">programming</a> (1)</li>
						
							<li><a href="/tag/python">python</a> (2)</li>
						
							<li><a href="/tag/reddit">reddit</a> (1)</li>
						
							<li><a href="/tag/software">software</a> (2)</li>
						
					</ul>
				</section>
			</aside>
		
		</div>
		
		<footer>
			This blog and its articles are licensed under the <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International</a> license. This basically means that you can copy, share and remix the articles, provided that you give appropriate credit, indicate if changes were made, and that it is not for commercial use.
		</footer>
	
	</div>
	</body>

</html>